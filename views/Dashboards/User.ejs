<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="stylesheets/Dashboard-css/Dashboard-2.css">
    <link rel="stylesheet" href="stylesheets/Dashboard-css/Dashboard-1.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
        }

        .wrapper {
            display: flex;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        nav {
            width: 20%;
            background-color: white;
            color: black;
            position: fixed;
            height: 100%;
        }

        .content {
            width: 80%;
            margin-left: 20%;
            padding: 20px;
            background-color: #ecf0f3;
        }

        .sidebar-header {
            padding: 20px;
            text-align: center;
        }

        .sidebar-header img {
            max-width: 50%;
        }

        .sidebar-header span {
            font-size: 1.5em;
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }

        ul.components {
            padding: 20px 0;
            list-style: none;
        }

        ul.components li {
            padding: 10px;
            font-size: 1.2em;
        }

        ul.components li.active,
        ul.components li:hover {
            background-color: #caa169;
            cursor: pointer;
        }

        ul.components li a {
            color: black;
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        ul.components li a .material-icons {
            margin-right: 10px;
        }

        .profile-content {
            width: 100%;
        }

        .card {
            width: 100%;
        }

        .row {
            margin: 0;
        }

        .card-title {
            text-align: center;
        }

        nav {
            height: 100vh;
            overflow-y: auto;
        }

        nav::-webkit-scrollbar {
            width: 8px;
        }

        nav::-webkit-scrollbar-thumb {
            background-color: #888;
            border-radius: 10px;
        }

        nav::-webkit-scrollbar-thumb:hover {
            background-color: #555;
        }

        /* Default background color for profile content */
        .profile-content {
            background-color: #ecf0f3;
        }

        /* Remove background color when hovered over the Booking dropdown */
        .profile-content.hovered {
            background-color: transparent;
        }

        /* Add this CSS to your existing styles */
        ul.components li.dropdown:hover~.content .profile-content {
            background-color: transparent;
            /* Remove the background color */
        }

        ul.components li.dropdown:hover~.content .profile-content .card {
            background-color: #ecf0f3;
            /* Ensure card background is not affected */
        }

        /* Booking Item Styles */
        .booking-item {
            background-color: white;
            /* Card background color */
            border-radius: 10px;
            /* Rounded corners */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            /* Subtle shadow for depth */
            padding: 20px;
            /* Padding inside the card */
            margin-bottom: 20px;
            /* Space between cards */
            display: flex;
            /* Flexbox for alignment */
            justify-content: space-between;
            /* Space between booking info and owner info */
            align-items: flex-start;
            /* Align items at the start */
        }

        .booking-info {
            display: flex;
            /* Flexbox for layout */
            align-items: center;
            /* Center items vertically */
            flex: 1;
            /* Allow it to take available space */
        }

        .pg-image img {
            width: 80px;
            /* Image width */
            height: 80px;
            /* Image height */
            object-fit: cover;
            /* Cover the area without distortion */
            border-radius: 10px;
            /* Round the image corners */
            margin-right: 20px;
            /* Space between image and details */
        }

        .details {
            display: flex;
            /* Flexbox for layout */
            flex-direction: column;
            /* Stack details vertically */
        }

        .owner-info {
            flex: 1;
            /* Allow it to take available space */
            margin-left: 20px;
            /* Space between booking info and owner info */
        }

        .actions {
            display: flex;
            /* Flexbox for layout */
            flex-direction: column;
            /* Stack buttons vertically */
            gap: 10px;
            /* Space between buttons */
        }

        button {
            padding: 10px;
            /* Button padding */
            border: none;
            /* Remove border */
            border-radius: 5px;
            /* Round button corners */
            font-size: 16px;
            /* Button font size */
        }

        .done-btn {
            background-color: #27ae60;
            /* Green background for done button */
            color: white;
            /* White text color */
        }

        .cancel-btn {
            background-color: #c0392b;
            /* Red background for cancel button */
            color: white;
            /* White text color */
        }

        /* Button hover effect */
        button:hover {
            opacity: 0.9;
            /* Slightly transparent on hover */
        }

        .main-content {
            padding: 20px;
            /* Add some padding for aesthetics */
        }

        /* Container for booking section to enable scrolling */
        #bookingSection {
            max-height: 85vh;
            /* Set a maximum height to enable scrolling */
            overflow-y: auto;
            /* Enable vertical scrolling */
            border: none;
            /* Optional: Add a border for visual separation */
            border-radius: 5px;
            /* Optional: Rounded corners */
            margin-top: 20px;
            /* Space between header and content */
        }

        /* Styling for each booking item */
        .booking-item {
            border-bottom: 1px solid #e0e0e0;
            /* Add a separator between items */
            padding: 15px;
            /* Add padding around the booking item */
        }

        .booking-item:last-child {
            border-bottom: none;
            /* Remove border for the last item */
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <nav id="sidebar">
            <div class="sidebar-header">
                <h3>
                    <a href="/Dashboard" style="text-decoration: none; color: black;">
                        <img src="../images/Images-Use/ContactUs/Logo-4.png" class="img-fluid" />
                        <span>Dashboard</span>
                    </a>
                </h3>
            </div>
            <ul class="list-unstyled components">
                <li>
                    <a href="#" class="dashboard" onclick="showProfile();"><i
                            class="material-icons">dashboard</i><span>My Profile</span></a>
                </li>
                <li class="dropdown">
                    <a href="#pageSubmenu2" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                        <i class="material-icons">apps</i><span>Bookings</span></a>
                    <ul class="collapse list-unstyled menu" id="pageSubmenu2">
                        <li><a href="#" onclick="showBookings();">Manage</a></li>
                        <li><a href="#" onclick="showCancelled();">Cancelled</a></li>
                        <li><a href="#" onclick="showCompleted();">Completed</a></li>
                    </ul>
                </li>
                <li>
                    <a href="/"><i class="material-icons">arrow_back</i><span>Back</span></a>
                </li>
            </ul>
        </nav>

        <div class="content">
            <div id="profile-content" class="profile-content">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Personal Details</h5>
                        <a class="edit-link float-right" data-toggle="modal" href="#edit_personal_details">
                            <!-- <i class="fa fa-edit mr-1"></i>Edit -->
                        </a>
                        <div class="row mt-5">
                            <p class="col-sm-3 text-left mb-0 mb-sm-3">Name :</p>
                            <p class="col-sm-9">
                                <%= userData.name %>
                            </p>
                        </div>
                        <div class="row">
                            <p class="col-sm-3 text-left mb-0 mb-sm-3">User ID :</p>
                            <p class="col-sm-3">
                                <%= userData.id %>
                            </p>
                        </div>
                        <div class="row">
                            <p class="col-sm-3 text-left mb-0 mb-sm-3">Email ID :</p>
                            <p class="col-sm-9"><a href="<%= userData.email %>" class="__cf_email__"
                                    style="text-transform: none;">
                                    <%= userData.email %>
                                </a></p>
                        </div>
                        <div class="row">
                            <p class="col-sm-3 text-left mb-0 mb-sm-3">Mobile No. :</p>
                            <p class="col-sm-9">
                                <%= userData.number %>
                            </p>
                        </div>
                        <div class="row">
                            <p class="col-sm-3 text-left mb-0 mb-sm-3">Profile Category :</p>
                            <p class="col-sm-9">User</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking Section -->
            <div class="main-content" id="booking-content" style="display:none;">
                <header>
                    <h1 style="text-align: center;margin-bottom: 30px;">Booking</h1>
                    <div class="profile-info">
                        <i class="fas fa-user-circle"></i>
                        <!-- <span>kashish@2003</span> -->
                    </div>
                </header>

                <section class="booking-list" id="bookingSection">
                    <!-- Booking Item 1 -->
                    <% BookingData.forEach(booking=> { %>
                        <% if (booking.b_status==='Pending' ) { %>
                            <div class="booking-item">
                                <div class="booking-info">
                                    <div class="pg-image">
                                        <img src="<%= booking.img_1 %>" alt="PG Image">
                                    </div>
                                    <div class="details">
                                        <p><b>Booking ID: </b><a href="#">#<%= booking.bid %></a></p>
                                        <p><b>Room ID: </b><a href="#">#<%= booking.rid %></a></p>
                                        <p><b>PG ID: </b><a href="#">#<%= booking.pg_id %></a></p>
                                        <p><b>PG Name: </b>
                                            <%= booking.pg_name %>
                                        </p>
                                    </div>
                                </div>
                                <div class="owner-info">
                                    <p><b>Owner Details</b></p>
                                    <p><b>Owner ID: </b>
                                        <%= booking.owner_id %>
                                    </p>
                                    <p><b>Contact No.:</b> <a href="tel:<%= booking.u_phoneNo %>">
                                            <%= booking.o_number %>
                                        </a></p>
                                    <p><b>Owner Name: </b>
                                        <%= booking.o_name %>
                                    </p>
                                    <p><b>PG Address: </b>
                                        <%= booking.p_address %>, <%= booking.p_city %>, Madhya Pradesh
                                    </p>
                                    <p><b>Booking Date:</b> <span>
                                            <%= new Date(booking.b_date).toLocaleDateString('en-US', {year: 'numeric' ,
                                                month: 'long' , day: 'numeric' }) %>
                                        </span></p>
                                </div>
                                <div class="actions">
                                    <button class="cancel-btn"
                                        onclick="window.location.href='/cancel/<%= booking.bid %>'">Cancel</button>
                                </div>
                            </div>
                            <% } %>
                                <% }); %>

                                    <!-- More booking items... -->
                </section>
            </div>


            <!-- Completed booking Start  -->
            <div class="main-content" id="completed-content" style="display:none;">
                <header>
                    <h1 style="text-align: center;margin-bottom: 30px;">Completed Booking</h1>
                    <div class="profile-info">
                        <i class="fas fa-user-circle"></i>
                        <!-- <span>kashish@2003</span> -->
                    </div>
                </header>

                <section class="booking-list" id="bookingSection" style="width: 100%; max-width: 1000px; margin: 0 auto; padding: 20px; display: flex; flex-direction: column; gap: 20px;">
                    <% BookingData.forEach(booking => { %>
                        <% if (booking.b_status === 'Confirmed') { %>
                            <div class="booking-item" style="display: flex; justify-content: space-between; align-items: flex-start; background-color: #f9f9f9; border-radius: 10px; padding: 15px; box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.1);">
                                <div class="booking-info" style="flex: 1; padding: 10px;">
                                    <div class="pg-image" style="width: 150px; height: 100px;">
                                        <img src="<%= booking.img_1 %>" alt="PG Image" style="width: 100%; height: 100%; object-fit: cover; border-radius: 5px;">
                                    </div>
                                    <div class="details" style="padding: 10px;">
                                        <p><b>Booking ID: </b><a href="#">#<%= booking.bid %></a></p>
                                        <p><b>Room ID: </b><a href="#">#<%= booking.rid %></a></p>
                                        <p><b>PG ID: </b><a href="#">#<%= booking.pg_id %></a></p>
                                        <p><b>PG Name: </b><%= booking.pg_name %></p>
                                    </div>
                                </div>
                                <div class="owner-info" style="flex: 1; padding: 10px;">
                                    <p><b>Owner Details</b></p>
                                    <p><b>Owner ID: </b><%= booking.owner_id %></p>
                                    <p><b>Contact No.:</b> <a href="tel:<%= booking.o_number %>"><%= booking.o_number %></a></p>
                                    <p><b>Owner Name: </b><%= booking.o_name %></p>
                                    <p><b>PG Address: </b><%= booking.p_address %>, <%= booking.p_city %>, Madhya Pradesh</p>
                                    <p><b>Booking Date:</b> <span><%= new Date(booking.b_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></span></p>
                                </div>
                
                                <!-- Feedback Section -->
                                <div class="feedback-section" style="flex: 1; padding: 10px; margin-top: 15px;">
                                    <% if (booking.Feedback_received === 'false') { %>
                                        <h3>Leave Feedback</h3>
                                        <form action="/submitFeedback" method="POST" style="display: flex; flex-direction: column; gap: 10px;">
                                            <input type="hidden" name="booking_id" value="<%= booking.bid %>">
                                            
                                            <label for="rating" style="font-weight: bold;">Star Rating:</label>
                                            <select name="rating" id="rating" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                                                <option value="1">1 Star</option>
                                                <option value="2">2 Stars</option>
                                                <option value="3">3 Stars</option>
                                                <option value="4">4 Stars</option>
                                                <option value="5">5 Stars</option>
                                            </select>
                
                                            <label for="subject" style="font-weight: bold;">Subject:</label>
                                            <input type="text" name="subject" id="subject" placeholder="Feedback subject" required style="padding: 8px; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                
                                            <label for="comment" style="font-weight: bold;">Comment:</label>
                                            <textarea name="comment" id="comment" placeholder="Your feedback" required style="padding: 8px; border: 1px solid #ddd; border-radius: 5px; width: 100%; resize: vertical; min-height: 80px;"></textarea>
                
                                            <button type="submit" class="submit-feedback-btn" style="background-color: #28a745; color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px; margin-top: 10px;">Submit Feedback</button>
                                        </form>
                                    <% } else if (booking.feedback) { %>
                                        <!-- Display Feedback if it exists -->
                                        <div class="feedback-display" style="margin-top: 20px; background-color: #e9f7ef; padding: 15px; border-radius: 5px; border: 1px solid #d4edda;">
                                            <h4>Feedback</h4>
                                            <p><b>Rating:</b> <%= booking.feedback.rating %> Stars</p>
                                            <p><b>Subject:</b> <%= booking.feedback.subject %></p>
                                            <p><b>Comment:</b> <%= booking.feedback.comment %></p>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                        <% } %>
                    <% }); %>
                </section>
                
                
                
            </div>
            <!-- Completed booking End -->

            <!-- Cancelled Booking Start  -->
            <div class="main-content" id="cancelled-content" style="display:none;">
                <header>
                    <h1 style="text-align: center;margin-bottom: 30px;">Cancelled Booking</h1>
                    <div class="profile-info">
                        <i class="fas fa-user-circle"></i>
                        <!-- <span>kashish@2003</span> -->
                    </div>
                </header>

                <section class="booking-list" id="bookingSection">
                    <!-- Booking Item 1 -->
                    <% BookingData.forEach(booking=> { %>
                        <% if (booking.b_status==='Cancelled' ) { %>
                            <div class="booking-item">
                                <div class="booking-info">
                                    <div class="pg-image">
                                        <img src="<%= booking.img_1 %>" alt="PG Image">
                                    </div>
                                    <div class="details">
                                        <p><b>Booking ID: </b><a href="#">#<%= booking.bid %></a></p>
                                        <p><b>Room ID: </b><a href="#">#<%= booking.rid %></a></p>
                                        <p><b>PG ID: </b><a href="#">#<%= booking.pg_id %></a></p>
                                        <p><b>PG Name: </b>
                                            <%= booking.pg_name %>
                                        </p>
                                    </div>
                                </div>
                                <div class="owner-info">
                                    <p><b>Owner Details</b></p>
                                    <p><b>Owner ID: </b>
                                        <%= booking.owner_id %>
                                    </p>
                                    <p><b>Contact No.:</b> <a href="tel:<%= booking.u_phoneNo %>">
                                            <%= booking.o_number %>
                                        </a></p>
                                    <p><b>Owner Name: </b>
                                        <%= booking.o_name %>
                                    </p>
                                    <p><b>PG Address: </b>
                                        <%= booking.p_address %>, <%= booking.p_city %>, Madhya Pradesh
                                    </p>
                                    <p><b>Booking Date:</b> <span>
                                            <%= new Date(booking.b_date).toLocaleDateString('en-US', {year: 'numeric' ,
                                                month: 'long' , day: 'numeric' }) %>
                                        </span></p>
                                </div>
                            </div>
                            <% } %>
                                <% }); %>

                                    <!-- More booking items... -->
                </section>
            </div>
            <!-- Cancelled Booking END  -->


            <!-- Modal for editing personal details -->
            <div class="modal fade" id="edit_personal_details" aria-hidden="true" role="dialog">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Personal Details</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="/edit">
                                <div class="row form-row">
                                    <div class="col-12 col-sm-6">
                                        <div class="form-group">
                                            <label>Name</label>
                                            <input type="text" class="form-control" value="<%= userData.name %>">
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-6">
                                        <div class="form-group">
                                            <label>Mobile No.</label>
                                            <input type="text" class="form-control" value="<%= userData.number %>">
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-6">
                                        <div class="form-group">
                                            <label>Email ID</label>
                                            <input type="email" class="form-control" value="<%= userData.email %>">
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary btn-block">Save Changes</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End of Modal -->
        </div>
    </div>

    <!-- Optional JavaScript -->
    <script src="javascripts/js/jquery-3.3.1.slim.min.js"></script>
    <script src="javascripts/js/popper.min.js"></script>
    <script src="javascripts/js/bootstrap.min.js"></script>
    <script src="javascripts/js/jquery-3.3.1.min.js"></script>



    <script type="text/javascript">

        // Place this script in the script section of your EJS file or in a separate JS file

        // Check if the page has been reloaded already
        if (!sessionStorage.getItem('hasReloaded')) {
            // Set a flag in sessionStorage to indicate that the page has been reloaded
            sessionStorage.setItem('hasReloaded', 'true');

            // Reload the page after 1 second (1000 milliseconds)
            setTimeout(function () {
                location.reload();
            }, 1000); // 1000 milliseconds = 1 second
        } else {
            // If the page has already been reloaded, remove the flag for future visits
            sessionStorage.removeItem('hasReloaded');
        }

        // Function to show the profile section
        function showProfile() {
            document.getElementById('profile-content').style.display = 'block'; // Show profile section
            document.getElementById('booking-content').style.display = 'none';  // Hide booking section
            document.getElementById('cancelled-content').style.display = 'none'; // Hide cancelled section
            document.getElementById('completed-content').style.display = 'none'; // Hide completed section
        }

        // Function to show the bookings section
        function showBookings() {
            document.getElementById('profile-content').style.display = 'none';  // Hide profile section
            document.getElementById('booking-content').style.display = 'block'; // Show booking section
            document.getElementById('cancelled-content').style.display = 'none'; // Hide cancelled section
            document.getElementById('completed-content').style.display = 'none'; // Hide completed section
        }

        // Function to show the cancelled bookings section
        function showCancelled() {
            document.getElementById('profile-content').style.display = 'none';  // Hide profile section
            document.getElementById('booking-content').style.display = 'none';  // Hide booking section
            document.getElementById('cancelled-content').style.display = 'block'; // Show cancelled section
            document.getElementById('completed-content').style.display = 'none'; // Hide completed section
        }

        // Function to show the completed bookings section
        function showCompleted() {
            document.getElementById('profile-content').style.display = 'none';  // Hide profile section
            document.getElementById('booking-content').style.display = 'none';  // Hide booking section
            document.getElementById('cancelled-content').style.display = 'none'; // Hide cancelled section
            document.getElementById('completed-content').style.display = 'block'; // Show completed section
        }

        $(document).ready(function () {
            $('#sidebarCollapse').on('click', function () {
                $('#sidebar').toggleClass('active');
                $('#content').toggleClass('active');
            });

            $('.more-button,.body-overlay').on('click', function () {
                $('#sidebar,.body-overlay').toggleClass('show-nav');
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            const bookingDropdown = document.getElementById('booking-dropdown');
            const profileContent = document.getElementById('profile-content');

            bookingDropdown.addEventListener('mouseover', () => {
                profileContent.classList.add('hovered');
            });

            bookingDropdown.addEventListener('mouseout', () => {
                profileContent.classList.remove('hovered');
            });
        });

    </script>
</body>

</html>